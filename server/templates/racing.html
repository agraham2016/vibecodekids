<!DOCTYPE html>
<html>
<head>
  <style>
    :root {
      --game-primary: #ff4444;
      --game-secondary: #16213e;
      --game-bg: #1a1a2e;
      --game-text: #ffffff;
      --game-accent: #00ff88;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    canvas { border-radius: 8px; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
    .controls-hint { margin-top: 16px; color: rgba(255,255,255,0.55); font-size: 13px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.86.0/dist/phaser.min.js"></script>
</head>
<body>
  <!-- GAME_TITLE -->Racing Game<!-- /GAME_TITLE -->
  <!-- PLAYER_CHARACTER -->car<!-- /PLAYER_CHARACTER -->
  <!-- OBSTACLES -->enemy_cars<!-- /OBSTACLES -->
  <div id="game"></div>
  <div class="controls-hint">&larr; &rarr; Steer &middot; &uarr; Accelerate &middot; &darr; Brake &middot; SPACE Restart</div>
<script>
const W = 800, H = 500, CW = 44, CH = 64;
const RL = 175, RR = 625, LANES = [250, 400, 550];

class Race extends Phaser.Scene {
  preload() {
    this.load.image('car-player', '/assets/sprites/racing/car-player.png');
    this.load.image('car-obstacle', '/assets/sprites/racing/car-obstacle.png');
    this.load.audio('hitSfx', '/assets/sounds/hit.wav');
    this.load.audio('explosionSfx', '/assets/sounds/explosion.wav');
  }

  create() {
    this.speed = 3;
    this.score = 0;
    this.alive = true;
    this.spawnCD = 0;
    this.elapsed = 0;

    this.buildRoad();

    this.dashes = [];
    [325, 475].forEach(x => {
      for (let y = -20; y < H + 60; y += 64)
        this.dashes.push(this.add.rectangle(x, y, 5, 28, 0xffffff));
    });

    this.player = this.physics.add.sprite(400, H - 70, 'car-player');
    this.player.setCollideWorldBounds(true);
    this.player.body.setSize(CW - 12, CH - 12);

    this.obs = this.physics.add.group();
    this.physics.add.overlap(this.player, this.obs, () => this.crash(), null, this);

    this.cursors = this.input.keyboard.createCursorKeys();
    this.spaceKey = this.input.keyboard.addKey('SPACE');

    const s = { fontFamily: 'Arial', fontSize: '18px', color: '#fff', stroke: '#000', strokeThickness: 3 };
    this.scoreTxt = this.add.text(16, 10, 'Distance: 0', s);
    this.spdTxt = this.add.text(W - 16, 10, '60 km/h', { ...s, color: '#00ff88' }).setOrigin(1, 0);
    this.msgTxt = this.add.text(W / 2, H / 2 - 20, '', { ...s, fontSize: '38px', color: '#ff4444' }).setOrigin(0.5);
    this.subTxt = this.add.text(W / 2, H / 2 + 28, '', s).setOrigin(0.5);
  }

  buildRoad() {
    const g = this.add.graphics();
    g.fillStyle(0x228833);
    g.fillRect(0, 0, W, H);
    g.fillStyle(0x555555);
    g.fillRect(RL, 0, RR - RL, H);
    g.fillStyle(0xeeeeee);
    g.fillRect(RL, 0, 4, H);
    g.fillRect(RR - 4, 0, 4, H);
  }

  crash() {
    if (!this.alive) return;
    this.alive = false;
    this.sound.play('explosionSfx');
    this.player.setTint(0xff0000);
    this.cameras.main.shake(250, 0.015);
    this.cameras.main.flash(200, 255, 60, 0);
    this.msgTxt.setText('CRASH!');
    this.subTxt.setText('Score: ' + Math.floor(this.score) + '  \u2014  SPACE to restart');
  }

  update(_, dt) {
    if (!this.alive) {
      if (Phaser.Input.Keyboard.JustDown(this.spaceKey)) this.scene.restart();
      return;
    }

    if (this.cursors.up.isDown) this.speed = Math.min(this.speed + 0.05, 9);
    else if (this.cursors.down.isDown) this.speed = Math.max(this.speed - 0.1, 1.5);

    if (this.cursors.left.isDown) this.player.x -= 4.5;
    if (this.cursors.right.isDown) this.player.x += 4.5;
    this.player.x = Phaser.Math.Clamp(this.player.x, RL + CW / 2 + 6, RR - CW / 2 - 6);

    const scroll = this.speed * 3;
    this.dashes.forEach(d => { d.y += scroll; if (d.y > H + 30) d.y -= H + 80; });

    this.obs.getChildren().forEach(o => {
      o.y += this.speed * 2.2;
      if (o.y > H + CH) o.destroy();
    });

    this.elapsed += dt;
    this.spawnCD += dt;
    const diff = 1 + this.elapsed / 12000;
    if (this.spawnCD > Math.max(350, 1300 / diff)) {
      const o = this.obs.create(Phaser.Math.RND.pick(LANES), -CH, 'car-obstacle');
      o.body.setSize(CW - 12, CH - 12);
      this.spawnCD = 0;
    }

    this.score += this.speed * dt / 100;
    this.scoreTxt.setText('Distance: ' + Math.floor(this.score));
    this.spdTxt.setText(Math.floor(this.speed * 20) + ' km/h');
  }
}

new Phaser.Game({
  type: Phaser.AUTO,
  width: W,
  height: H,
  parent: 'game',
  backgroundColor: '#228833',
  physics: { default: 'arcade' },
  scene: Race
});
</script>
</body>
</html>
