<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    :root {
      --game-primary: #ff6b35;
      --game-secondary: #f7c948;
      --game-bg: #1a1a2e;
      --game-text: #ffffff;
      --game-accent: #ff6b35;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #ff6b35 0%, #f7c948 50%, #1a1a2e 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
     touch-action: none; }
    #game-container {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div id="game-container"></div>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.86.0/dist/phaser.min.js"></script>
  <script>
  class RunnerScene extends Phaser.Scene {
    preload() {
      this.load.image('player', '/assets/sprites/endless-runner/player.png');
      this.load.image('obstacle', '/assets/sprites/endless-runner/obstacle.png');
      this.load.image('coin', '/assets/sprites/endless-runner/coin.png');
      this.load.image('ground', '/assets/sprites/endless-runner/ground.png');
      this.load.image('particle', '/assets/sprites/common/particle.png');
      this.load.audio('jumpSfx', '/assets/sounds/jump.wav');
      this.load.audio('coinSfx', '/assets/sounds/coin.wav');
      this.load.audio('hitSfx', '/assets/sounds/hit.wav');
    }

    create() {
      const g = this.make.graphics({ add: false });

      if (!this.textures.exists('player') || this.textures.get('player').key === '__MISSING') {
        g.fillStyle(0xff6b35); g.fillRoundedRect(0, 0, 30, 36, 4);
        g.fillStyle(0xffeaa7); g.fillCircle(15, 8, 8);
        g.fillStyle(0x2d3436); g.fillRect(11, 6, 3, 3); g.fillRect(17, 6, 3, 3);
        g.fillStyle(0xff6b35); g.fillRect(13, 12, 5, 2);
        g.fillStyle(0xf7c948); g.fillRect(4, 18, 8, 4); g.fillRect(18, 18, 8, 4);
        g.fillStyle(0x2d3436); g.fillRect(8, 32, 6, 4); g.fillRect(18, 32, 6, 4);
        g.generateTexture('player', 30, 36); g.clear();
      }
      if (!this.textures.exists('ground') || this.textures.get('ground').key === '__MISSING') {
        g.fillStyle(0x8B4513); g.fillRect(0, 0, 64, 32);
        g.fillStyle(0x2ecc71); g.fillRect(0, 0, 64, 8);
        g.fillStyle(0x27ae60); g.fillRect(0, 6, 64, 4);
        g.fillStyle(0xa0522d); g.fillRect(10, 16, 6, 4); g.fillRect(40, 20, 8, 4);
        g.generateTexture('ground', 64, 32); g.clear();
      }
      if (!this.textures.exists('obstacle') || this.textures.get('obstacle').key === '__MISSING') {
        g.fillStyle(0xe74c3c); g.fillRect(4, 4, 24, 28);
        g.fillStyle(0xc0392b); g.fillRect(8, 0, 16, 4);
        g.fillStyle(0xff6b6b);
        g.fillTriangle(16, 0, 8, 8, 24, 8);
        g.fillTriangle(16, 0, 4, 12, 28, 12);
        g.generateTexture('obstacle', 32, 32); g.clear();
      }
      if (!this.textures.exists('coin') || this.textures.get('coin').key === '__MISSING') {
        g.fillStyle(0xffd700); g.fillCircle(8, 8, 8);
        g.fillStyle(0xffa502); g.fillCircle(8, 8, 5);
        g.fillStyle(0xffd700); g.fillCircle(7, 6, 2);
        g.generateTexture('coin', 16, 16); g.clear();
      }
      if (!this.textures.exists('particle') || this.textures.get('particle').key === '__MISSING') {
        g.fillStyle(0xffffff); g.fillCircle(4, 4, 4);
        g.generateTexture('particle', 8, 8); g.clear();
      }
      g.destroy();

      this.score = 0;
      this.gameOver = false;
      this.baseSpeed = 240;
      this.gameSpeed = this.baseSpeed;
      this.speedIncrement = 4;
      this.lastObstacleX = 900;
      this.lastCoinX = 700;
      this.jumpCount = 0;
      this.maxJumps = 2;
      this.distanceTraveled = 0;

      const bg = this.add.graphics();
      bg.fillGradientStyle(0x1a1a2e, 0x1a1a2e, 0x2d1b69, 0x2d1b69);
      bg.fillRect(0, 0, 800, 500);

      this.bgStars = [];
      for (let i = 0; i < 60; i++) {
        const star = this.add.circle(
          Phaser.Math.Between(0, 800),
          Phaser.Math.Between(0, 350),
          Phaser.Math.Between(1, 2),
          0xffffff,
          Phaser.Math.FloatBetween(0.2, 0.8)
        );
        this.bgStars.push(star);
      }

      this.bgBuildings = this.add.graphics();
      this.bgBuildings.fillStyle(0x16213e, 0.6);
      for (let x = 0; x < 900; x += Phaser.Math.Between(60, 120)) {
        const h = Phaser.Math.Between(60, 180);
        const w = Phaser.Math.Between(40, 70);
        this.bgBuildings.fillRect(x, 410 - h, w, h);
        this.bgBuildings.fillStyle(0xf7c948, 0.3);
        for (let wy = 410 - h + 8; wy < 400; wy += 18) {
          for (let wx = x + 6; wx < x + w - 6; wx += 14) {
            this.bgBuildings.fillRect(wx, wy, 6, 8);
          }
        }
        this.bgBuildings.fillStyle(0x16213e, 0.6);
      }

      this.groundTiles = this.physics.add.staticGroup();
      for (let x = 0; x < 900; x += 64) {
        this.groundTiles.create(x + 32, 484, 'ground');
      }

      this.player = this.physics.add.sprite(120, 400, 'player');
      this.player.setCollideWorldBounds(true);
      this.player.setBounce(0);
      this.player.setGravityY(200);
      this.player.body.setSize(22, 32);
      this.player.body.setOffset(4, 4);

      this.obstacles = this.physics.add.group();
      this.coins = this.physics.add.group();

      this.physics.add.collider(this.player, this.groundTiles, () => {
        this.jumpCount = 0;
      });
      this.physics.add.overlap(this.player, this.coins, this.collectCoin, null, this);
      this.physics.add.overlap(this.player, this.obstacles, this.hitObstacle, null, this);

      this.sparkEmitter = this.add.particles(0, 0, 'particle', {
        speed: { min: 50, max: 150 },
        lifespan: 300,
        scale: { start: 1, end: 0 },
        emitting: false,
        quantity: 8,
        tint: [0xffd700, 0xffa502, 0xf7c948]
      });

      this.dustEmitter = this.add.particles(0, 0, 'particle', {
        speed: { min: 20, max: 60 },
        angle: { min: 200, max: 340 },
        lifespan: 400,
        scale: { start: 0.6, end: 0 },
        emitting: false,
        quantity: 4,
        tint: [0x8B4513, 0xa0522d]
      });

      const sh = { offsetX: 0, offsetY: 0, color: '#000', blur: 6, fill: true };
      this.scoreText = this.add.text(16, 16, 'Score: 0', {
        fontSize: '22px', fontFamily: 'Segoe UI', fill: '#f7c948',
        stroke: '#1a1a2e', strokeThickness: 3, shadow: sh
      }).setDepth(10);

      this.speedText = this.add.text(784, 16, 'Speed: 1x', {
        fontSize: '16px', fontFamily: 'Segoe UI', fill: '#ff6b35',
        stroke: '#1a1a2e', strokeThickness: 3, shadow: sh
      }).setOrigin(1, 0).setDepth(10);

      this.distText = this.add.text(400, 16, '0m', {
        fontSize: '16px', fontFamily: 'Segoe UI', fill: '#fff',
        stroke: '#1a1a2e', strokeThickness: 3, shadow: sh
      }).setOrigin(0.5, 0).setDepth(10);

      this.jumpKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
      this.upKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP);

      this.input.on('pointerdown', () => {
        if (this.gameOver) {
          this.scene.restart();
          return;
        }
        this.tryJump();
      });

      this.obstacleTimer = this.time.addEvent({
        delay: 1600,
        callback: this.spawnObstacle,
        callbackScope: this,
        loop: true
      });

      this.coinTimer = this.time.addEvent({
        delay: 1100,
        callback: this.spawnCoinGroup,
        callbackScope: this,
        loop: true
      });

      this.playerTrail = [];
    }

    tryJump() {
      if (this.gameOver) return;
      if (this.jumpCount < this.maxJumps) {
        this.player.setVelocityY(-440);
        this.jumpCount++;
        if (this.cache.audio.exists('jumpSfx')) this.sound.play('jumpSfx');
        this.dustEmitter.emitParticleAt(this.player.x, this.player.y + 16);
      }
    }

    spawnObstacle() {
      if (this.gameOver) return;

      const type = Phaser.Math.Between(0, 2);
      let obs;
      const baseX = 850;

      if (type === 0) {
        obs = this.obstacles.create(baseX, 452, 'obstacle');
        obs.body.setSize(24, 28);
        obs.setScale(1, 1);
      } else if (type === 1) {
        obs = this.obstacles.create(baseX, 444, 'obstacle');
        obs.body.setSize(24, 28);
        obs.setScale(1.2, 1.4);
      } else {
        obs = this.obstacles.create(baseX, 436, 'obstacle');
        obs.body.setSize(24, 28);
        obs.setScale(0.8, 1.8);
      }

      obs.body.allowGravity = false;
      obs.body.immovable = true;
      obs.setVelocityX(-this.gameSpeed);
    }

    spawnCoinGroup() {
      if (this.gameOver) return;
      const pattern = Phaser.Math.Between(0, 2);
      const baseX = 850;

      if (pattern === 0) {
        for (let i = 0; i < 3; i++) {
          this.spawnSingleCoin(baseX + i * 40, 420);
        }
      } else if (pattern === 1) {
        for (let i = 0; i < 3; i++) {
          this.spawnSingleCoin(baseX + i * 30, 420 - i * 30);
        }
      } else {
        for (let i = 0; i < 5; i++) {
          const y = 380 - Math.abs(i - 2) * 25;
          this.spawnSingleCoin(baseX + i * 30, y);
        }
      }
    }

    spawnSingleCoin(x, y) {
      const c = this.coins.create(x, y, 'coin');
      c.body.allowGravity = false;
      c.setVelocityX(-this.gameSpeed);
      this.tweens.add({
        targets: c, y: y - 6, duration: 400,
        yoyo: true, repeat: -1, ease: 'Sine.easeInOut'
      });
    }

    collectCoin(player, coin) {
      if (this.cache.audio.exists('coinSfx')) this.sound.play('coinSfx');
      this.sparkEmitter.emitParticleAt(coin.x, coin.y);
      coin.destroy();
      this.score += 10;
      this.scoreText.setText('Score: ' + this.score);

      this.tweens.add({
        targets: this.scoreText,
        scale: 1.3, duration: 80, yoyo: true, ease: 'Bounce'
      });
    }

    hitObstacle(player, obstacle) {
      if (this.gameOver) return;
      this.gameOver = true;
      if (this.cache.audio.exists('hitSfx')) this.sound.play('hitSfx');

      this.physics.pause();
      this.player.setTint(0xff0000);
      this.obstacleTimer.remove();
      this.coinTimer.remove();

      this.cameras.main.shake(300, 0.02);

      this.add.rectangle(400, 250, 800, 500, 0x000000, 0.7).setDepth(20);
      this.add.text(400, 170, 'GAME OVER', {
        fontSize: '48px', fill: '#ff6b35', fontFamily: 'Segoe UI', fontStyle: 'bold',
        stroke: '#1a1a2e', strokeThickness: 4,
        shadow: { offsetX: 0, offsetY: 0, color: '#ff6b35', blur: 16, fill: true }
      }).setOrigin(0.5).setDepth(21);

      this.add.text(400, 230, 'Score: ' + this.score, {
        fontSize: '28px', fill: '#f7c948', fontFamily: 'Segoe UI',
        stroke: '#1a1a2e', strokeThickness: 3
      }).setOrigin(0.5).setDepth(21);

      this.add.text(400, 270, 'Distance: ' + Math.floor(this.distanceTraveled) + 'm', {
        fontSize: '20px', fill: '#fff', fontFamily: 'Segoe UI'
      }).setOrigin(0.5).setDepth(21);

      this.add.text(400, 330, 'Click or SPACE to restart', {
        fontSize: '18px', fill: '#f7c948', fontFamily: 'Segoe UI'
      }).setOrigin(0.5).setDepth(21);

      this.input.keyboard.once('keydown-SPACE', () => this.scene.restart());
    }

    update(time, delta) {
      if (this.gameOver) return;

      if (Phaser.Input.Keyboard.JustDown(this.jumpKey) || Phaser.Input.Keyboard.JustDown(this.upKey)) {
        this.tryJump();
      }

      this.distanceTraveled += (this.gameSpeed * delta) / 8000;
      this.distText.setText(Math.floor(this.distanceTraveled) + 'm');

      this.gameSpeed = this.baseSpeed + Math.floor(this.distanceTraveled / 20) * this.speedIncrement;
      const speedMult = (this.gameSpeed / this.baseSpeed).toFixed(1);
      this.speedText.setText('Speed: ' + speedMult + 'x');

      const obstacleDelay = Math.max(700, 1600 - Math.floor(this.distanceTraveled / 10) * 30);
      if (this.obstacleTimer) this.obstacleTimer.delay = obstacleDelay;

      this.obstacles.children.each(obs => {
        if (!obs || !obs.active) return;
        obs.setVelocityX(-this.gameSpeed);
        if (obs.x < -50) obs.destroy();
      });

      this.coins.children.each(c => {
        if (!c || !c.active) return;
        c.body.velocity.x = -this.gameSpeed;
        if (c.x < -50) c.destroy();
      });

      this.groundTiles.children.each(tile => {
        tile.x -= this.gameSpeed * delta / 1000;
        if (tile.x < -32) tile.x += 900 + 64;
        tile.refreshBody();
      });

      this.bgStars.forEach(star => {
        star.x -= this.gameSpeed * delta / 6000;
        if (star.x < -5) star.x = 805;
      });

      if (this.player.body.touching.down && time % 100 < 20) {
        this.dustEmitter.emitParticleAt(this.player.x - 8, this.player.y + 16);
      }

      if (this.player.y > 510) {
        this.hitObstacle(this.player, null);
      }

      const runBob = Math.sin(time / 80) * 1.5;
      if (this.player.body.touching.down) {
        this.player.y += runBob * 0.3;
      }
    }
  }

  new Phaser.Game({
    type: Phaser.AUTO,
    width: 800,
    height: 500,
    parent: 'game-container',
    backgroundColor: '#1a1a2e',
    physics: { default: 'arcade', arcade: { gravity: { y: 800 }, debug: false } },
    scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
    scene: RunnerScene
  });
  </script>
</body>
</html>
