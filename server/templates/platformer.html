<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    :root {
      --game-primary: #ff6b6b;
      --game-secondary: #4ecdc4;
      --game-bg: #87CEEB;
      --game-text: #ffffff;
      --game-accent: #FFD700;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
     touch-action: none; }
    #game-container {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div id="game-container"></div>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.86.0/dist/phaser.min.js"></script>
  <script>
    const config = {
      type: Phaser.AUTO,
      width: 800,
      height: 500,
      parent: 'game-container',
      backgroundColor: '#87CEEB',
      physics: { default: 'arcade', arcade: { gravity: { y: 800 }, debug: false } },
      scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
      scene: { preload, create, update }
    };

    let player, cursors, coins, enemies, platforms, scoreText, score = 0, gameOver = false;
    let touchLeft = false, touchRight = false, touchJump = false;

    function preload() {
      this.load.image('player', '/assets/sprites/platformer/player.png');
      this.load.image('platform', '/assets/sprites/platformer/platform.png');
      this.load.image('coin', '/assets/sprites/platformer/coin.png');
      this.load.image('enemy', '/assets/sprites/platformer/enemy.png');
      this.load.image('particle', '/assets/sprites/common/particle.png');
      this.load.image('ground', '/assets/sprites/platformer/ground.png');
      this.load.audio('jumpSfx', '/assets/sounds/jump.wav');
      this.load.audio('coinSfx', '/assets/sounds/coin.wav');
      this.load.audio('hitSfx', '/assets/sounds/hit.wav');
    }

    function create() {
      if (!this.textures.exists('player') || !this.textures.exists('ground')) {
        const g = this.make.graphics({ x: 0, y: 0, add: false });
        g.fillStyle(0xff4757); g.fillRect(0, 0, 32, 40);
        g.fillStyle(0xffeaa7); g.fillRect(8, 4, 16, 12);
        g.fillStyle(0x2d3436); g.fillRect(12, 8, 3, 3); g.fillRect(19, 8, 3, 3);
        g.fillStyle(0xff4757); g.fillRect(14, 13, 6, 2);
        g.generateTexture('player', 32, 40); g.clear();
        g.fillStyle(0x2ecc71); g.fillRect(0, 0, 64, 16);
        g.fillStyle(0x27ae60); g.fillRect(0, 12, 64, 4);
        g.fillStyle(0x55efc4); g.fillRect(4, 2, 8, 3); g.fillRect(30, 2, 12, 3);
        g.generateTexture('platform', 64, 16); g.clear();
        g.fillStyle(0x8B4513); g.fillRect(0, 0, 64, 32);
        g.fillStyle(0x2ecc71); g.fillRect(0, 0, 64, 8);
        g.fillStyle(0xa0522d); g.fillRect(10, 14, 6, 6); g.fillRect(40, 20, 8, 4);
        g.generateTexture('ground', 64, 32); g.clear();
        g.fillStyle(0xffd700); g.fillCircle(8, 8, 8);
        g.fillStyle(0xffa502); g.fillCircle(8, 8, 5);
        g.fillStyle(0xffd700); g.fillCircle(7, 6, 2);
        g.generateTexture('coin', 16, 16); g.clear();
        g.fillStyle(0x6c5ce7); g.fillCircle(12, 14, 12);
        g.fillStyle(0xa29bfe); g.fillCircle(12, 10, 8);
        g.fillStyle(0xffffff); g.fillRect(6, 8, 5, 5); g.fillRect(14, 8, 5, 5);
        g.fillStyle(0x2d3436); g.fillRect(8, 10, 3, 3); g.fillRect(16, 10, 3, 3);
        g.generateTexture('enemy', 24, 26); g.clear();
        g.destroy();
      }

      this.physics.world.setBounds(0, 0, 2400, 500);
      const bg = this.add.graphics();
      bg.fillGradientStyle(0x87ceeb, 0x87ceeb, 0xf8a5c2, 0xf8a5c2); bg.fillRect(0, 0, 2400, 500);
      bg.fillGradientStyle(0xf8a5c2, 0xf8a5c2, 0xffeaa7, 0xffeaa7); bg.fillRect(0, 350, 2400, 150);

      const cloudG = this.add.graphics(); cloudG.fillStyle(0xffffff, 0.6);
      [120, 400, 750, 1100, 1500, 1900].forEach((x, i) => {
        const y = 40 + (i % 3) * 50;
        cloudG.fillCircle(x, y, 30); cloudG.fillCircle(x + 30, y - 10, 25); cloudG.fillCircle(x + 55, y, 28);
      });

      platforms = this.physics.add.staticGroup();
      for (let x = 0; x < 2400; x += 64) platforms.create(x + 32, 492, 'ground');
      [[200,380],[400,300],[600,350],[750,250],[1000,320],[1200,260],
       [1400,380],[1600,300],[1800,250],[2000,340],[2200,280]
      ].forEach(([x, y]) => platforms.create(x, y, 'platform'));

      player = this.physics.add.sprite(100, 400, 'player');
      player.setCollideWorldBounds(true); player.setBounce(0.1);

      coins = this.physics.add.group();
      [[200,340],[400,260],[600,310],[750,210],[1000,280],[1200,220],[1400,340],
       [1600,260],[1800,210],[2000,300],[2200,240],[300,440],[550,440],
       [900,440],[1300,440],[1700,440],[2100,440]
      ].forEach(([x, y]) => { const c = coins.create(x, y, 'coin'); c.setBounceY(0.3); });

      enemies = this.physics.add.group();
      [[380,270,340,460],[730,220,690,810],[1180,230,1140,1260],
       [1580,270,1540,1660],[1980,310,1940,2060]
      ].forEach(([x, y, min, max]) => {
        const e = enemies.create(x, y, 'enemy');
        e.setCollideWorldBounds(true); e.setBounce(1, 0); e.setVelocityX(60);
        e.patrolMin = min; e.patrolMax = max;
      });

      this.physics.add.collider(player, platforms);
      this.physics.add.collider(coins, platforms);
      this.physics.add.collider(enemies, platforms);
      this.physics.add.overlap(player, coins, collectCoin, null, this);
      this.physics.add.overlap(player, enemies, hitEnemy, null, this);

      scoreText = this.add.text(16, 16, 'Score: 0', {
        fontSize: '22px', fontFamily: 'Segoe UI', fill: '#fff', stroke: '#333', strokeThickness: 3
      }).setScrollFactor(0).setDepth(10);

      this.cameras.main.setBounds(0, 0, 2400, 500);
      this.cameras.main.startFollow(player, true, 0.08, 0.08);
      cursors = this.input.keyboard.createCursorKeys();
      this.input.keyboard.on('keydown-SPACE', () => {
        if (gameOver) { gameOver = false; score = 0; this.scene.restart(); }
      });

      if ('ontouchstart' in window) {
        const bw = 80, bh = 80, ba = 0.25, bd = 1000;
        const btnL = this.add.rectangle(50, 460, bw, bh, 0xffffff, ba).setScrollFactor(0).setDepth(bd).setInteractive();
        const btnR = this.add.rectangle(150, 460, bw, bh, 0xffffff, ba).setScrollFactor(0).setDepth(bd).setInteractive();
        const btnJ = this.add.rectangle(750, 460, bw, bh, 0xffffff, ba).setScrollFactor(0).setDepth(bd).setInteractive();
        this.add.text(50, 460, '\u25C0', { fontSize: '28px', fill: '#fff' }).setOrigin(0.5).setScrollFactor(0).setDepth(bd + 1);
        this.add.text(150, 460, '\u25B6', { fontSize: '28px', fill: '#fff' }).setOrigin(0.5).setScrollFactor(0).setDepth(bd + 1);
        this.add.text(750, 460, '\u25B2', { fontSize: '28px', fill: '#fff' }).setOrigin(0.5).setScrollFactor(0).setDepth(bd + 1);
        btnL.on('pointerdown', () => { touchLeft = true; });
        btnL.on('pointerup', () => { touchLeft = false; });
        btnL.on('pointerout', () => { touchLeft = false; });
        btnR.on('pointerdown', () => { touchRight = true; });
        btnR.on('pointerup', () => { touchRight = false; });
        btnR.on('pointerout', () => { touchRight = false; });
        btnJ.on('pointerdown', () => { touchJump = true; });
        btnJ.on('pointerup', () => { touchJump = false; });
        btnJ.on('pointerout', () => { touchJump = false; });
        this.input.on('pointerdown', () => { if (gameOver) { gameOver = false; score = 0; this.scene.restart(); } });
      }
    }

    function update() {
      if (gameOver) return;
      if (cursors.left.isDown || touchLeft) { player.setVelocityX(-200); player.setFlipX(true); }
      else if (cursors.right.isDown || touchRight) { player.setVelocityX(200); player.setFlipX(false); }
      else { player.setVelocityX(0); }
      if ((cursors.up.isDown || touchJump) && player.body.touching.down) {
        player.setVelocityY(-420);
        if (this.cache.audio.exists('jumpSfx')) this.sound.play('jumpSfx');
        touchJump = false;
      }
      enemies.children.iterate(e => {
        if (!e || !e.active) return;
        if (e.x <= e.patrolMin) e.setVelocityX(60);
        else if (e.x >= e.patrolMax) e.setVelocityX(-60);
      });
    }

    function collectCoin(p, coin) {
      coin.destroy(); score += 10; scoreText.setText('Score: ' + score);
      if (this.cache.audio.exists('coinSfx')) this.sound.play('coinSfx');
      const sparkle = this.add.circle(coin.x, coin.y, 10, 0xffd700);
      this.tweens.add({ targets: sparkle, scale: 2, alpha: 0, duration: 300, onComplete: () => sparkle.destroy() });
      if (coins.countActive(true) === 0) {
        scoreText.setText('YOU WIN! Score: ' + score + '\nPress SPACE'); gameOver = true;
      }
    }

    function hitEnemy(p, enemy) {
      if (this.cache.audio.exists('hitSfx')) this.sound.play('hitSfx');
      this.physics.pause(); player.setTint(0xff0000);
      scoreText.setText('GAME OVER! Score: ' + score + '\nPress SPACE'); gameOver = true;
    }

    const game = new Phaser.Game(config);
  </script>
</body>
</html>
